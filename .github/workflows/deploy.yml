name: Deploy ASP.NET Framework App to Somee via FTP

on:
  push:
    branches: [master]

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout cÃ³digo fuente
        uses: actions/checkout@v3

      - name: Instalar MSBuild
        uses: microsoft/setup-msbuild@v1.3.1

      - name: Restaurar paquetes NuGet (modo offline)
        run: nuget restore SistemaCateringParaEventos/SistemaCateringParaEventos.sln -NoCache -DisableParallelProcessing

      - name: Limpiar soluciÃ³n
        run: msbuild SistemaCateringParaEventos/SistemaCateringParaEventos.sln /t:Clean

      - name: Crear carpeta de publicaciÃ³n
        run: mkdir SistemaCateringParaEventos/publish_output

      - name: Compilar y publicar proyecto IUsuarios en Release
        run: |
          msbuild SistemaCateringParaEventos/IUVendedor/IUsuarios.csproj `
          /p:Configuration=Release `
          /p:DeployOnBuild=true `
          /p:WebPublishMethod=FileSystem `
          /p:PublishDir="$(pwd)/SistemaCateringParaEventos/publish_output/"

      - name: Mostrar archivos publicados
        run: Get-ChildItem -Recurse SistemaCateringParaEventos/publish_output


      - name: Verificar carpeta publicada
        run: dir SistemaCateringParaEventos\publish_output

      - name: ðŸ“‚ Deploy to FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: 155.254.246.25
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftp
          port: 21
          server-dir: /www.SistemaDeCatering.somee.com/
          dangerous-clean-slate: true
          local-dir: SistemaCateringParaEventos/publish_output/
          exclude: |
            **/packages/**
            **/*.nupkg
            **/*.cs
            **/*.csproj
